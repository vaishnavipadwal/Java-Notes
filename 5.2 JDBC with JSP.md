# **JSP with JDBC (Java Database Connectivity)**

JSP (JavaServer Pages) is a server-side technology that enables dynamic web pages using Java. It allows the embedding of Java code in HTML, making it easier to build web applications. When combined with JDBC, JSP can interact with a database to perform operations like adding, retrieving, updating, and deleting data.

Using JSP with JDBC, you can create dynamic web applications that allow users to interact with databases directly through the browser. In this approach, the front-end is managed by JSP, and database operations (CRUD) are handled using JDBC.

---

### **Steps to Use JSP with JDBC:**

1. **Set up the Database:**  
   Create a database and table in your preferred RDBMS (e.g., MySQL, PostgreSQL).

2. **Create the JSP File:**  
   JSP pages interact with the back-end database and display results to the user.

3. **JDBC in JSP:**  
   Within the JSP page, you write Java code using JDBC to connect to the database, execute queries, and display the results.

---

### **Example 1: JSP with JDBC for User Registration**

It is The example of a **user registration** system where a user enters their name and email, and the data is stored in a MySQL database.

#### **1. Set up the Database:**
First, create a MySQL database and a table to store user data.

```sql
CREATE DATABASE userdb;

USE userdb;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    email VARCHAR(50)
);
```

#### **2. JSP File (UserRegistration.jsp)**

This JSP file provides a form to enter user details and registers them into the database.

```jsp
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>User Registration</title>
</head>
<body>
    <h2>User Registration</h2>

    <form action="register.jsp" method="post">
        Name: <input type="text" name="name"><br>
        Email: <input type="text" name="email"><br>
        <input type="submit" value="Register">
    </form>

    <%
        String name = request.getParameter("name");
        String email = request.getParameter("email");

        if (name != null && email != null && !name.isEmpty() && !email.isEmpty()) {
            // Step 1: Load the JDBC driver
            try {
                Class.forName("com.mysql.cj.jdbc.Driver");

                // Step 2: Establish the connection to the database
                Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/userdb", "root", "password");

                // Step 3: Create the SQL query and the PreparedStatement
                String query = "INSERT INTO users (name, email) VALUES (?, ?)";
                PreparedStatement pst = con.prepareStatement(query);
                pst.setString(1, name);
                pst.setString(2, email);

                // Step 4: Execute the query
                int rows = pst.executeUpdate();

                // Step 5: Display a success message
                if (rows > 0) {
                    out.println("<h3>Registration Successful!</h3>");
                } else {
                    out.println("<h3>Registration Failed!</h3>");
                }

                // Step 6: Close the connection
                con.close();
            } catch (Exception e) {
                out.println("<h3>Error: " + e.getMessage() + "</h3>");
            }
        }
    %>
</body>
</html>
```

### **3. JSP Page (Display Users - DisplayUsers.jsp)**

We can also create a page to display the registered users from the database.

```jsp
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Registered Users</title>
</head>
<body>
    <h2>Registered Users</h2>

    <%
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/userdb", "root", "password");

            String query = "SELECT * FROM users";
            Statement stmt = con.createStatement();
            ResultSet rs = stmt.executeQuery(query);

            out.println("<table border='1'>");
            out.println("<tr><th>ID</th><th>Name</th><th>Email</th></tr>");

            while (rs.next()) {
                int id = rs.getInt("id");
                String name = rs.getString("name");
                String email = rs.getString("email");
                out.println("<tr><td>" + id + "</td><td>" + name + "</td><td>" + email + "</td></tr>");
            }

            out.println("</table>");

            con.close();
        } catch (Exception e) {
            out.println("<h3>Error: " + e.getMessage() + "</h3>");
        }
    %>
</body>
</html>
```

---

---

### **Explanation of the Program:**

1. **JSP Directives and Imports:**
   - `<%@ page import="java.sql.*" %>` imports JDBC classes to interact with the database.
   
2. **HTML Form:**
   - The form collects the user's **name** and **email** and submits them to the same page (`register.jsp`).

3. **Form Data Handling (JSP Scriptlet):**
   - Inside the scriptlet (`<% %>`), we retrieve the form values using `request.getParameter()`.
   - If both name and email are provided, we proceed with the JDBC operations.

4. **JDBC Steps:**
   - **Load the JDBC driver:** `Class.forName("com.mysql.cj.jdbc.Driver");` loads the MySQL JDBC driver.
   - **Establish the connection:** `DriverManager.getConnection()` connects to the `userdb` database using the provided credentials.
   - **Prepare the SQL query:** The `PreparedStatement` is used to safely insert user data into the database. Using `pst.setString()` prevents SQL injection.
   - **Execute the query:** `pst.executeUpdate()` runs the insert query, and the number of affected rows is checked to confirm if the operation was successful.
   - **Close the connection:** `con.close();` ensures the database connection is closed after the operation is complete.

5. **Error Handling:**
   - If any error occurs during the database operations, it is caught in the `catch` block and an error message is displayed to the user.

### **Explanation of Display Users Program:**

1. **JDBC Steps:**
   - The database connection is established again using `DriverManager.getConnection()`.
   - A `Statement` is created to execute the SQL `SELECT` query.
   - The result is stored in a `ResultSet`, and we loop through each row to display the user data in an HTML table.

2. **Error Handling:**
   - If any error occurs, it is caught, and the message is displayed to the user.


### **Important Considerations When Using JDBC with JSP:**

1. **Security:**  
   - Always use `PreparedStatement` to avoid SQL injection.
   - Avoid hardcoding sensitive information (like database credentials) directly in JSP. Use a configuration file or environment variables.

2. **Database Connection Pooling:**  
   - JDBC connections should be reused rather than repeatedly opening and closing them. Use a connection pool (e.g., Apache DBCP, C3P0) for better performance in real-world applications.

3. **Avoid Business Logic in JSP:**  
   - While it's possible to put JDBC code directly in JSP pages (as shown), it’s better to separate business logic from presentation by using **servlets** or **MVC frameworks** like **Spring MVC**. This makes the code more maintainable.
---

## **Example 2: JSP with JDBC (Display and Update Data)**

In this example, we will build a simple **user management system**. The system will display a list of users from the database and allow you to update their information (e.g., change their email address).

### **1. Database Setup:**

Let's assume you already have a database named `userdb` and a table named `users` with the following structure:

```sql
CREATE DATABASE userdb;

USE userdb;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    email VARCHAR(50)
);
```

---

### **2. JSP File to Display Users (DisplayUsers.jsp):**

This JSP page fetches and displays the list of users from the database.

```jsp
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Users List</title>
</head>
<body>
    <h2>List of Users</h2>

    <%
        // Establishing the database connection
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/userdb", "root", "password");

            // SQL query to fetch users
            String query = "SELECT * FROM users";
            Statement stmt = con.createStatement();
            ResultSet rs = stmt.executeQuery(query);

            // Displaying the users in a table
            out.println("<table border='1'>");
            out.println("<tr><th>ID</th><th>Name</th><th>Email</th><th>Action</th></tr>");

            while (rs.next()) {
                int id = rs.getInt("id");
                String name = rs.getString("name");
                String email = rs.getString("email");
                out.println("<tr>");
                out.println("<td>" + id + "</td>");
                out.println("<td>" + name + "</td>");
                out.println("<td>" + email + "</td>");
                out.println("<td><a href='update.jsp?id=" + id + "'>Update</a></td>");
                out.println("</tr>");
            }

            out.println("</table>");
            con.close();
        } catch (Exception e) {
            out.println("<h3>Error: " + e.getMessage() + "</h3>");
        }
    %>
</body>
</html>
```
### **3. JSP File to Update User Data (update.jsp):**

This page allows the user to update their name and email.

```jsp
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
<head>
    <title>Update User</title>
</head>
<body>
    <h2>Update User</h2>

    <%
        String id = request.getParameter("id");
        String name = "";
        String email = "";

        if (id != null) {
            try {
                Class.forName("com.mysql.cj.jdbc.Driver");
                Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/userdb", "root", "password");

                // Fetching the user details based on the ID
                String query = "SELECT * FROM users WHERE id = ?";
                PreparedStatement pst = con.prepareStatement(query);
                pst.setInt(1, Integer.parseInt(id));
                ResultSet rs = pst.executeQuery();

                if (rs.next()) {
                    name = rs.getString("name");
                    email = rs.getString("email");
                }

                con.close();
            } catch (Exception e) {
                out.println("<h3>Error: " + e.getMessage() + "</h3>");
            }
        }

        // Handling form submission to update user details
        String updatedName = request.getParameter("name");
        String updatedEmail = request.getParameter("email");

        if (updatedName != null && updatedEmail != null) {
            try {
                Class.forName("com.mysql.cj.jdbc.Driver");
                Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/userdb", "root", "password");

                // SQL query to update user data
                String updateQuery = "UPDATE users SET name = ?, email = ? WHERE id = ?";
                PreparedStatement pst = con.prepareStatement(updateQuery);
                pst.setString(1, updatedName);
                pst.setString(2, updatedEmail);
                pst.setInt(3, Integer.parseInt(id));

                int rowsUpdated = pst.executeUpdate();

                if (rowsUpdated > 0) {
                    out.println("<h3>User Updated Successfully!</h3>");
                } else {
                    out.println("<h3>Error: Unable to update user!</h3>");
                }

                con.close();
            } catch (Exception e) {
                out.println("<h3>Error: " + e.getMessage() + "</h3>");
            }
        }
    %>

    <!-- Form to update user details -->
    <form action="update.jsp?id=<%= id %>" method="post">
        Name: <input type="text" name="name" value="<%= name %>" /><br>
        Email: <input type="text" name="email" value="<%= email %>" /><br>
        <input type="submit" value="Update" />
    </form>
</body>
</html>
```

---
### **Explanation of Display Users Program:**

1. **JDBC Steps:**
   - A connection to the database is established using `DriverManager.getConnection()`.
   - A `Statement` is created to execute a `SELECT` query to fetch all users from the database.
   - The `ResultSet` is used to retrieve the result of the query and display each user's data in an HTML table.
   - Each user also has an "Update" link which directs to another JSP page (`update.jsp`) where the user can update their details.

2. **Error Handling:**
   - If any error occurs during database interaction, it is caught and displayed to the user.


### **Explanation of the Update Program:**

1. **Fetching Existing User Data:**
   - The user’s ID is passed through the URL (e.g., `update.jsp?id=1`).
   - The database is queried using this ID to retrieve the user's current name and email, which are displayed in the form.

2. **Updating User Data:**
   - Once the form is submitted, the updated name and email are retrieved from the form.
   - A SQL `UPDATE` query is executed using `PreparedStatement` to update the user’s information in the database.
   - A success or failure message is shown based on whether the update operation was successful.

---

